<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>个人博客</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            color: #333;
        }

        header {
            background-color: #333;
            color: #fff;
            padding: 1em;
            text-align: center;
            position: relative;
        }

        .container {
            padding: 2em;
            max-width: 800px;
            margin: 0 auto;
        }

        .dark-mode {
            background-color: #333;
            color: #fff;
        }

        .post {
            border-bottom: 1px solid #ccc;
            padding: 1em 0;
        }

        .post-title {
            font-size: 1.5em;
            margin: 0;
        }

        .post-content {
            margin: 1em 0 0;
        }

        .toggle-mode {
            position: absolute;
            top: 1em;
            right: 1em;
            background: none;
            border: 1px solid #fff;
            color: #fff;
            padding: 0.5em;
            cursor: pointer;
        }

        .profile {
            text-align: center;
            margin-bottom: 2em;
        }

        .profile img {
            border-radius: 50%;
            width: 100px;
            height: 100px;
        }

        .create-post, .edit-post {
            margin: 2em 0;
        }

        .create-post input, .edit-post input, .create-post textarea, .edit-post textarea {
            display: block;
            width: 100%;
            margin: 0.5em 0;
            padding: 0.5em;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .post-actions {
            display: flex;
            justify-content: space-between;
        }

        .search {
            margin: 2em 0;
        }

        .search input {
            width: 100%;
            padding: 0.5em;
            margin: 0.5em 0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .tags {
            margin: 1em 0;
            text-align: center;
        }

        .tags span {
            background-color: #ddd;
            padding: 0.5em;
            margin: 0.2em;
            display: inline-block;
            cursor: pointer;
        }

        .comments {
            margin-top: 1em;
        }

        .comment {
            border-top: 1px solid #eee;
            padding: 0.5em 0;
        }

        .comment input, .comment textarea {
            display: block;
            width: 100%;
            margin: 0.5em 0;
            padding: 0.5em;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .like-button {
            background-color: #007bff;
            color: #fff;
            border: none;
            padding: 0.5em 1em;
            cursor: pointer;
            border-radius: 5px;
        }

        .like-button.liked {
            background-color: #28a745;
        }

        .pagination {
            display: flex;
            justify-content: center;
            margin: 2em 0;
        }

        .pagination button {
            padding: 0.5em 1em;
            margin: 0 0.5em;
            cursor: pointer;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <header>
        <h1>个人博客</h1>
        <button class="toggle-mode" onclick="toggleMode()">切换模式</button>
    </header>
    <div class="container">
        <div class="search">
            <input type="text" id="search" placeholder="搜索文章..." oninput="searchPosts()">
        </div>
        <div class="create-post">
            <h2>创建文章</h2>
            <input type="text" id="new-post-title" placeholder="文章标题">
            <textarea id="new-post-content" placeholder="文章内容"></textarea>
            <input type="text" id="new-post-tags" placeholder="文章标签（用逗号分隔）">
            <button onclick="createPost()">创建</button>
        </div>
        <div class="tags">
            <span onclick="filterByTag('all')">所有</span>
            <!-- 动态生成标签 -->
        </div>
        <div class="posts">
            <!-- Posts will be dynamically added here -->
        </div>
        <div class="edit-post" style="display: none;">
            <h2>编辑文章</h2>
            <input type="text" id="edit-post-title" placeholder="文章标题">
            <textarea id="edit-post-content" placeholder="文章内容"></textarea>
            <input type="text" id="edit-post-tags" placeholder="文章标签（用逗号分隔）">
            <button onclick="savePost()">保存</button>
        </div>
        <div class="stats">
            <p>文章总数: <span id="total-posts">0</span></p>
            <p>总字数: <span id="total-words">0</span></p>
        </div>
        <div class="pagination">
            <button onclick="prevPage()">上一页</button>
            <span id="page-info">第 1 页</span>
            <button onclick="nextPage()">下一页</button>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        function toggleMode() {
            document.body.classList.toggle('dark-mode');
        }

        let posts = [
            {
                id: 1,
                title: "First Post",
                content: "This is the content of the first post.",
                tags: ["example", "first"],
                comments: [
                    { author: "User1", text: "Great post!", likes: 0 },
                    { author: "User2", text: "Thanks for sharing.", likes: 0 }
                ]
            },
            {
                id: 2,
                title: "Second Post",
                content: "This is the content of the second post.",
                tags: ["example", "second"],
                comments: []
            }
        ];

        let nextPostId = 3;
        let tags = [];
        let currentTag = 'all';

        function createPost() {
            const title = document.getElementById('new-post-title').value;
            const content = document.getElementById('new-post-content').value;
            const tagsInput = document.getElementById('new-post-tags').value;
            const postTags = tagsInput.split(',').map(tag => tag.trim()).filter(tag => tag);
            if (title && content) {
                posts.push({
                    id: nextPostId++,
                    title,
                    content,
                    tags: postTags,
                    comments: []
                });
                updateTags();
                renderPosts();
                document.getElementById('new-post-title').value = '';
                document.getElementById('new-post-content').value = '';
                document.getElementById('new-post-tags').value = '';
            } else {
                alert('标题和内容不能为空');
            }
        }

        function updateTags() {
            tags = posts.reduce((acc, post) => {
                post.tags.forEach(tag => {
                    if (!acc.includes(tag)) {
                        acc.push(tag);
                    }
                });
                return acc;
            }, []);
            renderTags();
        }

        function renderTags() {
            const tagsContainer = document.querySelector('.tags');
            tagsContainer.innerHTML = '<span onclick="filterByTag(\'all\')">所有</span>';
            tags.forEach(tag => {
                const tagElement = document.createElement('span');
                tagElement.innerText = tag;
                tagElement.onclick = () => filterByTag(tag);
                tagsContainer.appendChild(tagElement);
            });
        }

        function filterByTag(tag) {
            currentTag = tag;
            renderPosts();
        }

        function searchPosts() {
            const query = document.getElementById('search').value.toLowerCase();
            renderPosts(query);
        }

        function renderPosts(query = '') {
            const postsContainer = document.querySelector('.posts');
            postsContainer.innerHTML = '';
            posts.filter(post => {
                return (currentTag === 'all' || post.tags.includes(currentTag)) &&
                    (post.title.toLowerCase().includes(query) || post.content.toLowerCase().includes(query));
            }).forEach(post => {
                const postElement = document.createElement('div');
                postElement.className = 'post';
                postElement.innerHTML = `
                    <h2 class="post-title">${post.title}</h2>
                    <div class="post-content">
                        ${marked(post.content)}
                    </div>
                    <div class="post-actions">
                        <button onclick="editPost(${post.id})">编辑</button>
                        <button onclick="deletePost(${post.id})">删除</button>
                    </div>
                    <div class="comments">
                        <h3>评论</h3>
                        ${post.comments.map(comment => `
                            <div class="comment">
                                <p><strong>${comment.author}</strong></p>
                                <p>${comment.text}</p>
                                <button class="like-button" onclick="likeComment(${post.id}, ${post.comments.indexOf(comment)})">点赞 (${comment.likes})</button>
                            </div>
                        `).join('')}
                        <div class="add-comment">
                            <input type="text" placeholder="你的名字" id="comment-author-${post.id}">
                            <textarea placeholder="你的评论" id="comment-text-${post.id}"></textarea>
                            <button onclick="addComment(${post.id})">添加评论</button>
                        </div>
                    </div>
                `;
                postsContainer.appendChild(postElement);
            });
            updateStats();
        }

        function editPost(id) {
            const post = posts.find(p => p.id === id);
            if (post) {
                document.querySelector('.edit-post').style.display = 'block';
                document.getElementById('edit-post-title').value = post.title;
                document.getElementById('edit-post-content').value = post.content;
                document.getElementById('edit-post-tags').value = post.tags.join(', ');
                document.querySelector('.edit-post').dataset.id = id;
            }
        }

        function savePost() {
            const id = parseInt(document.querySelector('.edit-post').dataset.id, 10);
            const title = document.getElementById('edit-post-title').value;
            const content = document.getElementById('edit-post-content').value;
            const tagsInput = document.getElementById('edit-post-tags').value;
            const postTags = tagsInput.split(',').map(tag => tag.trim()).filter(tag => tag);
            const postIndex = posts.findIndex(p => p.id === id);
            if (postIndex > -1) {
                posts[postIndex].title = title;
                posts[postIndex].content = content;
                posts[postIndex].tags = postTags;
                renderPosts();
                document.querySelector('.edit-post').style.display = 'none';
            }
        }

        function deletePost(id) {
            posts = posts.filter(p => p.id !== id);
            renderPosts();
        }

        function addComment(postId) {
            const author = document.getElementById(`comment-author-${postId}`).value;
            const text = document.getElementById(`comment-text-${postId}`).value;
            if (author && text) {
                const postIndex = posts.findIndex(p => p.id === postId);
                if (postIndex > -1) {
                    posts[postIndex].comments.push({ author, text, likes: 0 });
                    renderPosts();
                }
            } else {
                alert('名字和评论不能为空');
            }
        }

        function likeComment(postId, commentIndex) {
            const postIndex = posts.findIndex(p => p.id === postId);
            if (postIndex > -1) {
                posts[postIndex].comments[commentIndex].likes++;
                renderPosts();
            }
        }

        function updateStats() {
            const totalPosts = posts.length;
            const totalWords = posts.reduce((acc, post) => acc + post.content.split(' ').length, 0);
            document.getElementById('total-posts').innerText = totalPosts;
            document.getElementById('total-words').innerText = totalWords;
        }

        updateTags();
        renderPosts();
    </script>
</body>
</html>
        .comments {
            margin-top: 1em;
        }

        .comment {
            border-top: 1px solid #eee;
            padding: 0.5em 0;
        }

        .comment input, .comment textarea {
            display: block;
            width: 100%;
            margin: 0.5em 0;
            padding: 0.5em;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .like-button {
            background-color: #007bff;
            color: #fff;
            border: none;
            padding: 0.5em 1em;
            cursor: pointer;
            border-radius: 5px;
        }

        .like-button.liked {
            background-color: #28a745;
        }

        .pagination {
            display: flex;
            justify-content: center;
            margin: 2em 0;
        }

        .pagination button {
            padding: 0.5em 1em;
            margin: 0 0.5em;
            cursor: pointer;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .auth {
            text-align: center;
            margin: 2em 0;
        }

        .auth input {
            display: block;
            width: 100%;
            margin: 0.5em 0;
            padding: 0.5em;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        .auth button {
            padding: 0.5em 1em;
            margin: 0.5em;
            cursor: pointer;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <header>
        <h1>个人博客</h1>
        <button class="toggle-mode" onclick="toggleMode()">切换模式</button>
    </header>
    <div class="container">
        <div class="auth">
            <h2>注册</h2>
            <input type="text" id="register-username" placeholder="用户名">
            <input type="password" id="register-password" placeholder="密码">
            <button onclick="register()">注册</button>
            <h2>登录</h2>
            <input type="text" id="login-username" placeholder="用户名">
            <input type="password" id="login-password" placeholder="密码">
            <button onclick="login()">登录</button>
        </div>
        <div class="profile" style="display: none;">
            <img src="data:image/png;base64, " alt="Profile Picture" id="profile-pic">
            <p id="profile-nickname">昵称: </p>
            <p id="profile-email">Email: </p>
            <p id="profile-github">GitHub: </p>
            <p id="profile-minecraft">Minecraft: </p>
        </div>
        <div class="search" style="display: none;">
            <input type="text" id="search" placeholder="搜索文章..." oninput="searchPosts()">
        </div>
        <div class="create-post" style="display: none;">
            <h2>创建文章</h2>
            <input type="text" id="new-post-title" placeholder="文章标题">
            <textarea id="new-post-content" placeholder="文章内容"></textarea>
            <input type="text" id="new-post-tags" placeholder="文章标签（用逗号分隔）">
            <button onclick="createPost()">创建</button>
        </div>
        <div class="tags" style="display: none;">
            <span onclick="filterByTag('all')">所有</span>
            <!-- 动态生成标签 -->
        </div>
        <div class="posts" style="display: none;">
            <!-- Posts will be dynamically added here -->
        </div>
        <div class="edit-post" style="display: none;">
            <h2>编辑文章</h2>
            <input type="text" id="edit-post-title" placeholder="文章标题">
            <textarea id="edit-post-content" placeholder="文章内容"></textarea>
            <input type="text" id="edit-post-tags" placeholder="文章标签（用逗号分隔）">
            <button onclick="savePost()">保存</button>
        </div>
        <div class="stats" style="display: none;">
            <p>文章总数: <span id="total-posts">0</span></p>
            <p>总字数: <span id="total-words">0</span></p>
        </div>
        <div class="pagination" style="display: none;">
            <button onclick="prevPage()">上一页</button>
            <span id="page-info">第 1 页</span>
            <button onclick="nextPage()">下一页</button>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        function toggleMode() {
            document.body.classList.toggle('dark-mode');
        }

        const base64Image = "BASE64_ENCODED_IMAGE_STRING";
        document.getElementById('profile-pic').src = base64Image;

        let users = [];
        let currentUser = null;

        let posts = [
            {
                id: 1,
                title: "First Post",
                content: "This is the content of the first post.",
                tags: ["example", "first"],
                comments: [
                    { author: "User1", text: "Great post!", likes: 0 },
                    { author: "User2", text: "Thanks for sharing.", likes: 0 }
                ]
            },
            {
                id: 2,
                title: "Second Post",
                content: "This is the content of the second post.",
                tags: ["example", "second"],
                comments: []
            }
        ];

        let nextPostId = 3;
        let tags = [];
        let currentTag = 'all';

        function register() {
            const username = document.getElementById('register-username').value;
            const password = document.getElementById('register-password').value;
            if (username && password) {
                if (!users.some(user => user.username === username)) {
                    users.push({ username, password });
                    alert('注册成功');
                } else {
                    alert('用户名已存在');
                }
            } else {
                alert('用户名和密码不能为空');
            }
        }

        function login() {
            const username = document.getElementById('login-username').value;
            const password = document.getElementById('login-password').value;
            const user = users.find(user => user.username === username && user.password === password);
            if (user) {
                currentUser = user;
                document.querySelector('.auth').style.display = 'none';
                document.querySelector('.profile').style.display = 'block';
                document.querySelector('.search').style.display = 'block';
                document.querySelector('.create-post').style.display = 'block';
                document.querySelector('.tags').style.display = 'block';
                document.querySelector('.posts').style.display = 'block';
                document.querySelector('.edit-post').style.display = 'none';
                document.querySelector('.stats').style.display = 'block';
                document.querySelector('.pagination').style.display = 'block';
            } else {
                alert('用户名或密码错误');
            }
        }

        function createPost() {
            const title = document.getElementById('new-post-title').value;
            const content = document.getElementById('new-post-content').value;
            const tagsInput = document.getElementById('new-post-tags').value;
            const postTags = tagsInput.split(',').map(tag => tag.trim()).filter(tag => tag);
            if (title && content) {
                posts.push({
                    id: nextPostId++,
                    title,
                    content,
                    tags: postTags,
                    comments: []
                });
                updateTags();
                renderPosts();
                document.getElementById('new-post-title').value = '';
                document.getElementById('new-post-content').value = '';
                document.getElementById('new-post-tags').value = '';
            } else {
                alert('标题和内容不能为空');
            }
        }

        function updateTags() {
            tags = posts.reduce((acc, post) => {
                post.tags.forEach(tag => {
                    if (!acc.includes(tag)) {
                        acc.push(tag);
                    }
                });
                return acc;
            }, []);
            renderTags();
        }

        function renderTags() {
            const tagsContainer = document.querySelector('.tags');
            tagsContainer.innerHTML = '<span onclick="filterByTag(\'all\')">所有</span>';
            tags.forEach(tag => {
                const tagElement = document.createElement('span');
                tagElement.innerText = tag;
                tagElement.onclick = () => filterByTag(tag);
                tagsContainer.appendChild(tagElement);
            });
        }

        function filterByTag(tag) {
            currentTag = tag;
            renderPosts();
        }

        function searchPosts() {
            const query = document.getElementById('search').value.toLowerCase();
            renderPosts(query);
        }

        function renderPosts(query = '') {
            const postsContainer = document.querySelector('.posts');
            postsContainer.innerHTML = '';
            posts.filter(post => {
                return (currentTag === 'all' || post.tags.includes(currentTag)) &&
                    (post.title.toLowerCase().includes(query) || post.content.toLowerCase().includes(query));
            }).forEach(post => {
                const postElement = document.createElement('div');
                postElement.className = 'post';
                postElement.innerHTML = `
                    <h2 class="post-title">${post.title}</h2>
                    <div class="post-content">
                        ${marked(post.content)}
                    </div>
                    <div class="post-actions">
                        <button onclick="editPost(${post.id})">编辑</button>
                        <button onclick="deletePost(${post.id})">删除</button>
                    </div>
                    <div class="comments">
                        <h3>评论</h3>
                        ${post.comments.map(comment => `
                            <div class="comment">
                                <p><strong>${comment.author}</strong></p>
                                <p>${comment.text}</p>
                                <button class="like-button" onclick="likeComment(${post.id}, ${post.comments.indexOf(comment)})">点赞 (${comment.likes})</button>
                            </div>
                        `).join('')}
                        <div class="add-comment">
                            <input type="text" placeholder="你的名字" id="comment-author-${post.id}">
                            <textarea placeholder="你的评论" id="comment-text-${post.id}"></textarea>
                            <button onclick="addComment(${post.id})">添加评论</button>
                        </div>
                    </div>
                `;
                postsContainer.appendChild(postElement);
            });
            updateStats();
        }

        function editPost(id) {
            const post = posts.find(p => p.id === id);
            if (post) {
                document.querySelector('.edit-post').style.display = 'block';
                document.getElementById('edit-post-title').value = post.title;
                document.getElementById('edit-post-content').value = post.content;
                document.getElementById('edit-post-tags').value = post.tags.join(', ');
                document.querySelector('.edit-post').dataset.id = id;
            }
        }

        function savePost() {
            const id = parseInt(document.querySelector('.edit-post').dataset.id, 10);
            const title = document.getElementById('edit-post-title').value;
            const content = document.getElementById('edit-post-content').value;
            const tagsInput = document.getElementById('edit-post-tags').value;
            const postTags = tagsInput.split(',').map(tag => tag.trim()).filter(tag => tag);
            const postIndex = posts.findIndex(p => p.id === id);
            if (postIndex > -1) {
                posts[postIndex].title = title;
                posts[postIndex].content = content;
                posts[postIndex].tags = postTags;
                renderPosts();
                document.querySelector('.edit-post').style.display = 'none';
            }
        }

        function deletePost(id) {
            posts = posts.filter(p => p.id !== id);
            renderPosts();
        }

        function addComment(postId) {
            const author = document.getElementById(`comment-author-${postId}`).value;
            const text = document.getElementById(`comment-text-${postId}`).value;
            if (author && text) {
                const postIndex = posts.findIndex(p => p.id === postId);
                if (postIndex > -1) {
                    posts[postIndex].comments.push({ author, text, likes: 0 });
                    renderPosts();
                }
            } else {
                alert('名字和评论不能为空');
            }
        }

        function likeComment(postId, commentIndex) {
            const postIndex = posts.findIndex(p => p.id === postId);
            if (postIndex > -1) {
                posts[postIndex].comments[commentIndex].likes++;
                renderPosts();
            }
        }

        function updateStats() {
            const totalPosts = posts.length;
            const totalWords = posts.reduce((acc, post) => acc + post.content.split(' ').length, 0);
            document.getElementById('total-posts').innerText = totalPosts;
            document.getElementById('total-words').innerText = totalWords;
        }

        updateTags();
        renderPosts();
    </script>
</body>
</html>
